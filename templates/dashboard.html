{% extends "base.html" %}

{% block content %}

    <!doctype html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Dosis:200,300,400,500,600,700" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:200,300,400,500,600,700" rel="stylesheet">
        <meta property="og:title" content="python ê³µë¶€ê¿€íŒì‚¬ì´íŠ¸"/>
        <meta property="og:description" content="python ê³µë¶€ê¿€íŒì‚¬ì´íŠ¸ ê³µìœ í•´ì£¼ì‹œê³  ê°€ì„¸ìš”!"/>
        <meta property="og:image"
              content="https://s3.ap-northeast-2.amazonaws.com/grepp-cloudfront/programmers_imgs/learn/thumb-course-phthon-basic.jpg"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
              crossorigin="anonymous">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
                crossorigin="anonymous"></script>
        <title>pythonê³µë¶€ ê¿€íŒì‚¬ì´íŠ¸</title>
        <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
        <style>
        </style>
        <script>
        </script>
    </head>

    <div class="head">
        <div class="mytitle">
            <h1>{{ session['user']['name'] }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ğŸ˜ </h1><br>
            <h2>íŒŒì´ì¬ ê³µë¶€ ê¿€íŒì‚¬ì´íŠ¸</h2>
        </div>
    </div>
    <h5 class="center">
        <button onclick="open_box()">ê¿€íŒì‚¬ì´íŠ¸ê³µìœ í•˜ê¸°</button>
    </h5>
    </div>
    <div class="card-wrapper">
        <div class="mypost" id="post-box">
            <div class="form-floating mb-3">
                <input id="url" type="email" class="form-control" placeholder="name@example.com">
                <label>ê¿€íŒì‚¬ì´íŠ¸URL</label>
            </div>
            <div class="form-floating mb-3">
                <label class="input-group-text" for="inputGroupSelect01">ë³„ì </label>
                <select class="form-select" id="star">
                    <option selected>--------------- ì„ íƒí•˜ê¸° --------</option>
                    <option value="1">â­</option>
                    <option value="2">â­â­</option>
                    <option value="3">â­â­â­</option>
                    <option value="4">â­â­â­â­</option>
                    <option value="5">â­â­â­â­â­</option>
                </select>
            </div>
            <div class="form-floating mb-3">
                <textarea id="comment" class="form-control" placeholder="Leave a comment here"></textarea>
                <label for="floatingTextarea2">ì½”ë©˜íŠ¸</label>
            </div>
            <div class="mybtn">
                <button onclick="posting()" type="button" class="btn btn-dark">ì‚¬ì´íŠ¸ê¸°ë¡í•˜ê¸°</button>
                <!--ì‚¬ì´íŠ¸ê¸°ë¡í•˜ê¸° ë²„íŠ¼ ì„ íƒ > posting() í•¨ìˆ˜ë¡œ ì´ë™ë¨ -->
                <button onclick="close_box()" type="button" class="btn btn-outline-dark">ë‹«ê¸°</button>
            </div>
        </div>
        <!----------  ì—¬ê¸°ê¹Œì§€ê°€ id : post-box <div>ì˜ì—­  --------------------------------------------------------------------->
        <div class="myedit" id="edit-box">
        </div>
        <div class="delete" id="delete-box">
        </div>
    </div>
    <div class="mycards">
        <div class="row row-cols-1 row-cols-md-4 g-4" id="cards-box">
        </div>
    </div>
    <div class="wrap">
    </div>
    </body>

       <div id="disqus_thread" >
           <a href="http://foo.com/bar.html#disqus_thread">Link</a>.
           <script id="dsq-count-scr" src="//hanghae-1.disqus.com/count.js" async></script>
       </div>
        <script>
                //ìƒë‹¨ ê¿€íŒ ì‚¬ì´íŠ¸ ê³µìœ í•˜ê¸° ì…ë ¥ ë°•ìŠ¤ ì—´ê¸°
        function open_box() {
            $('#post-box').show() // id: post-box
        }
        function close_box() {
            $('#post-box').hide()
        }
        $(document).ready(function () {
            listing();
        });
        function listing() {
            $.ajax({
                type: 'GET',
                url: '/pythonthema',
                data: {},
             success: function (response) {
                    let rows = response['pythonthema']
                    for (let i = 0; i < rows.length; i++) {
                        let num = rows[i]['num']
                        let comment = rows[i]['comment']
                        let title = rows[i]['title']
                        let desc = rows[i]['desc']
                        let image = rows[i]['image']
                        let star = rows[i]['star']
                        let star_image = 'â­'.repeat(star)
                        let temp_html = `<div class="col">
                                            <div class="card h-100">
                                                    <img src="${image}"  class="card-img-top">
                                                    <div class="card-body">

                                                        <h5 class="card-title">${title}</h5>
                                                        <p class="card-text">${desc}</p>
                                                        <p>${star_image}</p>
                                                        <p class="mycomment">${comment}</p>
                                                    </div>
                                                    <div class="change">
                                                        <div class="btns">
                                                             <button onclick="open_edit(${num})" type="button" class="btn btn-outline-secondary btn-sm">ìˆ˜ì •</button>
                                                             <button onclick="delete_edit(${num})" type="button" class="btn btn-outline-secondary btn-sm">ì‚­ì œ</button>
                                                        </div>
                                                    </div>
                                            </div>
                                        </div>`
                        $('#cards-box').append(temp_html)
                    }
                }
            })
        }
        //delete_edit
          function delete_edit(num){
            $('#delete-box').empty() //
            $('#delete-box').show()  //id: delete-box
            let temp_html = `<h3>ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
                                  <div class="delete_btns">
                                      <button onclick="delete_btn(${num})" type="button" class="btn btn-outline-dark ">ì‚­ì œ</button>
                                      <button onclick="cancel_btn()" type="button" class="btn btn-dark ">ì·¨ì†Œ</button>
                                  </div>`
            $('#delete-box').append(temp_html)
          }
          //delete_btn
          function delete_btn(num){             // delete_benì— numê°’ ë³´ë‚´ê¸°
                     $.ajax({
                        type: "POST",                   // POST ìš”ì²­
                        url: "/delete",                 // /delete ê²½ë¡œì—
                        data: {num_give: num},          // numì„ ë°›ì•„ì„œ
                        success: function (response) {  // ì„±ê³µí•˜ë©´, responseì— ê°’ì„ ë‹´ì•„ì„œ
                            alert(response["msg"])      // msgë¥¼ ë„ìš´ë‹¤.

                            window.location.reload()  //ìƒˆë¡œê³ ì¹¨
                        }
                 });
          }
          //cancel_btn
         function cancel_btn() {          // cancel_btn í•¨ìˆ˜
            $('#delete-box').hide()       // id: delete-box ìˆ¨ê¸°ê¸°
            window.location.reload()      // ìƒˆë¡œê³ ì¹¨
        }
        // ì €ì¥ ìë°”ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜
        // ì‚¬ì´íŠ¸ url, ë³„ì , ì½”ë©˜íŠ¸ ì…ë ¥ í›„, ì‚¬ì´íŠ¸ê¸°ë¡í•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ë©´,
        // posting í•¨ìˆ˜ë¡œ ì´ë™ë˜ì–´ ì—¬ê¸°ë¡œ ë„ì°©
        function posting() {
            let url = $('#url').val()          //  inputì— ì…ë ¥í•œ id: url ì˜ ì…ë ¥ëœ ê°’ì„ ê°€ì ¸ì™€ì„œ urlë¡œ ë„£ëŠ”ë‹¤.
            let star = $('#star').val()        //  inputì— ì…ë ¥í•œ id: star ì˜ ì…ë ¥ëœ ê°’ì„ ê°€ì ¸ì™€ì„œ star ë¡œ ë„£ëŠ”ë‹¤.
            let comment = $('#comment').val()  // inputì— ì…ë ¥í•œ id: commentì˜ ì…ë ¥ëœ ê°’ì„ ê°€ì ¸ì™€ì„œ commentë¡œ ë„£ëŠ”ë‹¤.
            let num = $('#num').val()          // â˜…â˜…â˜…num ê°’ì„ ì¶”ê°€// numê°’ì´ pythonthema dbì— ë“¤ì–´ì˜¨ê²ƒ í™•ì¸ num:12
            $.ajax({                           // ajax POST ë°©ì‹ìœ¼ë¡œ /pythonthema ê²½ë¡œë¡œ , data{url_give: url, star_give:star, comment_give:comment }ë¥¼ ë³´ë‚¸ë‹¤.
                type: 'POST',                   // POST ìš”ì²­
                url: '/pythonthema',            // app.py íŒŒì¼ì˜ /pythonthema ê²½ë¡œë¡œ 'POST' ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
                data: {url_give: url, star_give: star, comment_give: comment, num_give: num }, // num ê°’ ì „ë‹¬ ì¶”ê°€
                success: function (response) {    // ì„±ê³µí•˜ë©´ reponseì— url, star, commentì˜ ê°’ì„ ë‹´ì•„ ë³´ë‚¸ë‹¤.
                    alert(response['msg'])       // 'msg' ë¥¼ ì–¼ëŸ¿ìœ¼ë¡œ ë„ìš´ë‹¤.
                    window.location.reload()     // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í•œë‹¤.
                }
            });
        }
        // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ onclick ì´ë²¤íŠ¸ë¥¼ í†µí•´ì„œ, open_edit í•¨ìˆ˜ë¡œ ì´ë™ë˜ì–´ ì—¬ê¸°ë¡œ ì˜¨ë‹¤.
        function open_edit(num){ // num ê°’ì„ ê°€ì ¸ì˜¨ë‹¤
            $('#edit-box').empty() // id: edit-boxë¥¼ ë¹„ìš´ë‹¤.
            $('#edit-box').show()  // id: edit-boxë¥¼ ë³´ì—¬ì¤€ë‹¤.
            $.ajax({               // ajax GET ë°©ì‹ìœ¼ë¡œ /edit ê²½ë¡œë¡œ num ê°’ì„ ë³´ë‚¸ë‹¤.
                type: 'GET',       // GET ìš”ì²­
                url: '/open/edit',      // app.py íŒŒì¼ì˜ /edit ê²½ë¡œë¡œ 'GET' ìš”ì²­ì„ ë³´ë‚¸ë‹¤.
                data: {num_give: num}, // num ê°’ì„ ë³´ë‚¸ë‹¤.
                success: function (response) { // ì„±ê³µí•˜ë©´ responseì— num, url, star, comment ê°’ì„ ë‹´ì•„ ë³´ë‚¸ë‹¤.
                    let rows = (response['pythonthema']) // pythonthema í…Œì´ë¸”ì˜ ëª¨ë“  ê°’ì„ rowsì— ë‹´ëŠ”ë‹¤.
                     for (let i=0; i<rows.length; i++){
                         let num1 = rows[i]['num'] // num ê°’ì„ num1ì— ë‹´ëŠ”ë‹¤.
                         let url = rows[i]['url'] // url ê°’ì„ urlì— ë‹´ëŠ”ë‹¤.
                         let star = rows[i]['star'] // star ê°’ì„ starì— ë‹´ëŠ”ë‹¤.
                         let comment = rows[i]['comment'] // comment ê°’ì„ commentì— ë‹´ëŠ”ë‹¤.
                         let temp_html = `` // temp_htmlì— html ì½”ë“œë¥¼ ë‹´ëŠ”ë‹¤.

                         if(num === num1) {
                             temp_html = `
                                             <div class="edit-box">
                                                 <div class="edit-box-title">
                                                     <h3>ì‚¬ì´íŠ¸ ìˆ˜ì •í•˜ê¸°</h3>
                                                 </div>
                                                 <div class="edit-box-content">
                                                     <div class="edit-box-content-url">
                                                         <input type="text" id="url_e" value="${url}">
                                                     </div>
                                                     <div class="edit-box-content-star">
                                                         <input type="text" id="star_e" value="${star}">
                                                     </div>
                                                     <div class="edit-box-content-comment">
                                                         <input type="text" id="comment_e" value="${comment}">
                                                     </div>
                                                     <div class="edit-box-content-btn">
                                                         <button class="edit-box-content-btn-save" onclick="edit_order(${num})">ìˆ˜ì •í•˜ê¸°</button>
                                                         <button class="edit-box-content-btn-cancel" onclick="close_edit()">ë‹«ê¸°</button>
                                                     </div>
                                                 </div>
                                             </div> `
                         } else {
                             temp_html = ``
                         }
                            $('#edit-box').append(temp_html) // id: edit-boxì— temp_htmlì„ ì¶”ê°€í•œë‹¤.
                     }
                }
            });
        }
           // ìˆ˜ì •ì…ë ¥ ë°•ìŠ¤ ë‹«ê¸°, ìˆ˜ì •ì…ë ¥ë°•ìŠ¤ id: #edit-box
        function close_edit(){
            $('#edit-box').hide()
            window.location.reload()
        }

        //ìˆ˜ì •í•˜ê¸° ë²„íŠ¼ ì„ íƒ ì‹œ, edit_order() í•¨ìˆ˜ì‹¤í–‰
        function edit_order(num){
                let url = $('#url_e').val()
                let star = $('#star_e').val()
                let comment = $('#comment_e').val()
                    $.ajax({
                        type: 'POST',
                        url: '/save/edit',
                        data: {url_give: url, star_give: star, comment_give: comment, num_give: num },
                        success: function (response) {
                            alert(response['msg'])
                            window.location.reload()
                        }
                });
        }
        </script>
        <script>

            (function () {
                var d = document, s = d.createElement('script');
                s.src = 'https://hanghae-1.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>

    </html>
{% endblock %}